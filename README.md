
# Интеллект-карта: Процесс оплаты заказа в приложении

## Центральный узел: Процесс оплаты заказа

### 1. Покупатель
**Действия:**
- Выбор товаров в корзину
- Подтверждение заказа
- Ввод платежных данных
- Подтверждение оплаты

**Данные:**
- ID пользователя
- История заказов
- Сохраненные карты
- Контактные данные

### 2. Frontend приложения
**Экраны:**
- Корзина товаров
- Оформление заказа
- Платежная форма
- Результат оплаты

**Функции:**
- Валидация данных
- Навигация между экранами
- Отображение статусов
- Уведомления пользователю

### 3. Backend приложения
**Модули:**
- Управление заказами
- Интеграция с ИПА
- Обработка callback'ов
- Генерация чеков

**API endpoints:**
- `/api/orders/create`
- `/api/payments/init`
- `/api/payments/status`
- `/api/receipts/generate`

### 4. База данных
**Таблицы:**
- `orders` (заказы)
- `payments` (платежи)
- `users` (пользователи)
- `receipts` (чеки)

**Поля заказа:**
- order_id
- user_id
- total_amount
- status
- created_at

### 5. ИПА (Платежный шлюз)
**Функции:**
- Создание платежной сессии
- Перенаправление в банк
- Обработка 3D Secure
- Callback уведомления

**Данные:**
- transaction_id
- payment_url
- status
- auth_code

### 6. Банк-эквайер
**Процессы:**
- Авторизация карты
- Проверка 3D Secure
- Блокировка средств
- Подтверждение транзакции

**Статусы:**
- SUCCESS
- DECLINED
- PENDING
- ERROR

### 7. Уведомления
**Типы:**
- Push-уведомления
- Email сообщения
- SMS информирование
- In-app нотификации

**События:**
- Заказ создан
- Ожидание оплаты
- Успешная оплата
- Ошибка оплаты

### 8. Чек и документация
**Документы:**
- Электронный чек
- Квитанция об оплате
- Детали заказа
- Гарантийный талон

**Данные чека:**
- Номер чека
- Дата и время
- Сумма
- Способ оплаты

## Детальная визуализация процесса:

```mermaid
graph TD
    A[Процесс оплаты заказа]
    
    %% Основной поток
    P[Покупатель] --> F[Frontend]
    F --> B[Backend]
    B --> I[ИПА]
    I --> BK[Банк]
    BK --> I
    I --> B
    B --> DB[База данных]
    B --> N[Уведомления]
    B --> R[Чек]
    R --> P
    
    %% Подпроцессы покупателя
    P1[Выбор товаров] --> P2[Подтверждение заказа]
    P2 --> P3[Ввод платежных данных]
    P3 --> P4[Подтверждение оплаты]
    P --> P1
    
    %% Подпроцессы фронтенда
    F1[Корзина] --> F2[Оформление]
    F2 --> F3[Оплата]
    F3 --> F4[Результат]
    F --> F1
    
    %% Подпроцессы бэкенда
    B1[Создание заказа] --> B2[Инициализация платежа]
    B2 --> B3[Обработка callback]
    B3 --> B4[Обновление статуса]
    B --> B1
    
    %% Подпроцессы ИПА
    I1[Создание сессии] --> I2[Перенаправление в банк]
    I2 --> I3[Ожидание ответа]
    I3 --> I4[Callback магазину]
    I --> I1
    
    %% Связи между подпроцессами
    P4 --> F3
    F4 --> B4
    B1 --> DB
    B4 --> DB
    B4 --> N
    B4 --> R
    I4 --> B3
